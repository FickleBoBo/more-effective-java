## 정적 팩터리 메서드와 싱글턴 패턴의 차이

`Effective Java` 2장 객체 생성과 파괴 - '아이템 1. 생성자 대신 정적 팩터리 메서드 고려하라' 를 읽고

### 정리

**내용 요약**

1. 정적 팩터리 메서드란

    클래스의 객체를 생성하기 위해 생성자와 별개로 정적 팩토리 메서드를 사용 가능하다. 쉽게 말해 `static method`로 객체를 생성하는 방식이다.
    `List`자료형의 `of()` 메서드와 `Integer` Wrapper 클래스의 `valueOf()` 등 우리는 이미 자바에서 제공 중인 정적 팩토리 메서드를 이용해 왔다.


2. 정적 팩터리 메서드 사용 시 장점
   - 이름을 가질 수 있다.
   - 호출 시 마다 객체를 새로 생성하지 않아도 된다.
   - 반환 타입의 하위 타입 객체를 반환할 수 있다.
   - 매개변수에 따라 다른 객체를 반환할 수 있다.
   - 정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다. 
  
    위와 같은 유연함을 가지고 있다.

3. 정적 팩터리 메서드 사용 시 단점
    - 상속 불가능
    - 다른 개발자들이 찾기 어려움

4. 결론

    정적 팩터리 메서드로 객체를 생성하는 방식이 더 유리할 때가 많지만, 생성자 방식과 각각 각자의 쓰임새가 있으니, 상대적 장단점을 이해하고 사용해 보도록 하자.

    개인적으로는 장점을 가지는 경우들에서 사용할 수 있도록 유의하면서, 특히 객체 초기화 과정이 복잡하고 많은 단계를 거쳐야 한다면 그 로직을 정적으로 구현하여 간단한 객체 생성을 하는 것이 좋다고 생각한다.



### 심화 탐구

**출발점**

우리는 항상 불필요한 객체 생성을 막아 메모리 절약 · 코드의 가독성을 향상시키고자 노력 중이다. 이 때 정적 팩터리 메서드와, 기존 알고 있던 싱글턴 패턴은 구체적으로 어떤 차이가 있을까? 이 의문을 해결하기 위해 싱글턴 패턴부터 다시 문서 열람을 시작했고 아래에 요약해 보도록 하겠다.

**설명**

1. 싱글턴 디자인 패턴이란

    우선 디자인 패턴은 소프트웨어 설계에서 흔히 발생하는 문제에 대한 일반적인 해결책을 의미한다. (코드로 작성한 해결책은 문제가 발생하는 다양한 상황에 적용될 수 있다)

    **싱글턴 패턴**이란 클래스의 인스턴스가 단 하나만 생성되도록 보장하는 기술이다. 이 기술은 클래스 외부에 있는 사람이 개체의 인스턴스를 생성하지 못하도록 한다.

    즉 생성자가 여러번 호출되더라도 **실제 생성되는 객체는 하나**이고, 최초 생성 이후에 호출된 생성자는 최초의 생성자가 생성한 객체를 리턴하게 된다.
    
    예를 들어, 클래스는 아래와 같이 싱글턴 패턴을 구현 가능하다.

    - 클래스의 생성자(constructor)를 `private`로 선언하여 해당 클래스를 제외한 다른 모든 클래스가 인스턴스를 생성하지 못하도록 한다.
    - 멤버 변수를 `static`으로 정의하여 인스턴스가 하나만 존재하도록 한다.
    - 멤버 변수에 대한 다른 클래스의 접근을 허용하는 메서드인 `getInstance`를 정의한다.

        코드로 정리하면 다음과 같다.
        ```java
        public class Music {
            private static Music music = new Music();
            // 객체를 private 접근자로 설정하고 딱 하나만 생성해둔다


            private Music() {}
            // 기본 생성자를 private 접근자로 지정한다

            public static Music getMusic() {
                return music;
            }
            // 객체를 getter를 통해 가져올 수 있도록 한다 (신규 생성 방지)
            // 이 때 setter는 불필요하다
            // 객체 없이도 외부에서 접근이 가능하도록, getter와 변수에는 static이 필수적이다
        }
        ```

        위 코드를 통해 싱글턴 패턴을 구현 가능하고, 외부에서는 언제나 `getter`를 통해 `music` 객체를 참조하게 되므로 하나의 객체를 재사용하는 것과 같다.


2. 실무에서 싱글턴 패턴이 정적 클래스보다 선호되기도 한다

    - 테스트 가능성

        싱글턴 패턴은 상태를 가질 수 있고, 생성과 파괴 시기를 선택할 수 있어 여러 가지 테스트를 하는데 문제가 없지만, 정적 클래스의 경우는 테스트마다 영향을 받을 수 있어 어려움을 느낀다. 

   - 확장성

        싱글턴 패턴은 상속이 가능하므로 기존의 클래스 특징과 같이 상속을 이용하여 다형성과 확장성을 구현할 수 있다.

   - 인터페이스의 구현

        “유연한 프로그램을 만드려면 인터페이스를 타입으로 사용하라” 라는 말이 있다고 한다. 나중에 새롭게 구현된 클래스가 생겨도 추가적인 코드 수정없이 사용이 가능하기 때문이다. 싱글턴 패턴은 정적 클래스와 달리, 이 인터페이스의 구현이 가능하다. 인터페이스를 구현해주고 그 객체의 생성을 클래스에서 한 개로 제한하는게 싱글턴 패턴이다.

**추가적으로 학습해 볼 개념**

- 불변 클래스(immutable calss)
- 플라이웨이트 패턴(Flyweight pattern)
- 인스턴스화 불가 (noninstantiable)
- 인스턴스 통제 (instance-controlled) 클래스


**참고 자료**

*https://docs.oracle.com/javase/tutorial/ext/basics/spi.html*

*https://www.oracle.com/technical-resources/articles/java/singleton.html*

*https://www.yegor256.com/2016/06/27/singletons-must-die.html*

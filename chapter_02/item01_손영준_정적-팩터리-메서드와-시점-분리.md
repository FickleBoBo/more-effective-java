## 정적 팩터리 메서드와 시점 분리

### 정리

1. 정적 팩토리 메서드란 무엇인가?

클래스 인스턴스는 전통적으로 생성자를 이용하여 생성되나, 정적 팩터리 메서드(static factory method)를 이용할수도 있다. 정적 팩터리 메서드는 객체 생성에의 통제를 생성자가 아닌 스태틱 메서드로 위임한다. 

대표적인 방식으로는 싱글톤 패턴(Singleton)이 있다. 싱글톤 패턴이 익숙한 만큼, `getInstance()` 라는 표현 역시 익숙하다.  생성자는 분명히 private 접근 제어자를 통해 외부에서의 생성이 금지되어 있다. 반면, 해당 객체를 이용하기 위해서 `getInstance()` 메서드를 호출한다. 사실 싱글턴 패턴은 정적 팩토리 메서드의 특별한 형태 중 하나로 볼 수 있다.

이는 곧 정적 팩토리 메서드와 싱글톤 패턴이 공유하는 부분이 있음을 의미한다. 바로 객체의 요청에 대해 새로 인스턴스를 생성하는 대신, 이미 만들어진 인스턴스를 반환한다는 점이다.

1. 정적 팩터리 메소드의 특징

물론 정적 팩터리 메소드는 생성자가 필요한 상속이 불가능하고, 인스턴스화할 방식에 대해 찾는 노고가 필요하다는 단점은 있다. 하지만 조슈아 블로흐에 따르면, 정적 팩토리 메소드의 이점과 생성자 사용에서의 이점을 비교해볼 필요가 있다.

정적 팩토리 메서드는 다음 다섯 가지 장점을 가진다.

- 메서드명을 통해서 객체 생성에서 그 특성을 드러내어 코드 가독성을 증진한다.

- 미리 인스턴스를 만들어 이용하기에, 불필요한 객체 생성에 따른 비용이 감소한다. 나아가 인스턴스를 통제할 수 있다.

- 반환 타입의 하위 객체를 유연하게 반환하는 동시에 의존성 역전이 이루어진다.

- 매개 변수에 따라 다른 하위 클래스 객체를 외부에 드러내지 않고 반환함으로써, 기존 클래스를 이용하는 코드의 안정성이 유지된다.

- 정적 팩토리 메서드 작성 시점과 객체 클래스 생성 시점이 분리된다.

**내용 요약**

“정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다”는 것이 어떻게 유연함으로 이어지는가? 그리고 이것이 어떻게 ‘서비스 제공자 프레임워크’의 역할이 되는가? 문제는 내가 전자의 말을 이해하지 못하면서, ‘서비스 제공자 프레임워크’가 무엇인지도 모른다는 점이었다. JDBC와 리플렉션은 차치하고서라도 말이다.

### 심화 탐구

**출발점**

“정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다”는 것이 어떻게 유연함으로 이어지는가? 그리고 이것이 어떻게 ‘서비스 제공자 프레임워크’의 역할이 되는가? 문제는 내가 전자의 말을 이해하지 못하면서, ‘서비스 제공자 프레임워크’가 무엇인지도 모른다는 점이었다. JDBC와 리플렉션은 차치하고서라도 말이다.

**설명**

이 말에는 두 가지 중요한 단어가 있다. 하나는 ‘시점’이고, 다른 하나는 ‘클래스’다. 두 용어가 가지는 의미는 생성자를 통한 객체 생성과 비교할 때 커진다.

위의 설명에 따르면, 정적 팩터리 메서드를 작성하는 시점과 객체 반환 시점은 분리되어 있다.

우선, 정적 팩토리 메서드 작성 시점은 컴파일 시점과 동일하다. 앞서 살펴본 장점에 걸맞추어 인터페이스를 반환 타입으로 삼는다고 가정해보자. 그렇다면 아래와 같은 코드가 가능해진다.

```java
public static MyInterface getMyInterfaceInstance() {
    // 동적으로 instance를 불러와 반환하는 코드
    return ...
}
```

`getMyInterface()`는 반환 타입에 해당하는 class가 생성되기 이전에도 컴파일 에러가 발생하지 않는다. `getMyInterface()`의 구체적인 반환 객체는 런타임 시점에 결정된다. 즉, 정적 팩토리 메소드의 ‘작성 시점’인 컴파일 시점에는 ‘클래스’(구현체)가 존재하지 않아도 된다. 대신, 런타임 시점에는 구현체가 존재해야 할 것이다.

서비스 제공자 프레임워크(service provider framework) 역시 이와 같은 방식을 취한다. 특히 프레임워크는 구현체를 통제하고, 구현체는 프레임워크를 통해서만 클라이언트에게 전달된다.

### 참고 자료

https://stackoverflow.com/questions/929021/what-are-static-factory-methods

https://stackoverflow.com/questions/53240626/what-does-static-factories-returned-object-need-not-exist-mean

https://stackoverflow.com/questions/11823773/understanding-the-concept-behind-service-provider-framework-like-jdbc-using-the
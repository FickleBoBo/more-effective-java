# 톱레벨 클래스에 대한 디버깅 테스트



## item25 - 톱레벨 클래스는 한 파일에 하나만 담으라

### 🔍 내용 요약

소스 파일 하나에 톱레벨 클래스를 여러 개 선언하더라도 자바 컴파일러는 불평하지 않는다. 하지만 아무런 득이 없을 뿐더러 심각한 위험을 감수해야 하는 행위다. 이렇게 하면 한 클래스를 여러 가지로 정의할 수 있으며, 그중 어느 것을 사용할 지는 어느 소스 파일을 먼저 컴파일하냐에 따라 달라지기 때문이다. 이러한 문제를 피하는 아주 쉬운 방법은 **소스 파일 하나에는 반드시 톱레벨 클래스(혹은 톱레벨 인터페이스)를 하나만 담는 것**이다. 

<br>

--------------------------------------------------

### 🧐 심화 탐구

하나의 소스 파일에 톱레벨 클래스를 여러 개 담아서 프로젝트 구조를 깔끔하게 만들고 싶다는 유혹이 들 수 있다고 생각한다. APS과정에서 자료구조를 직접 구현해보며 
Stack과 Queue를 Main class와 동일 레벨에 둔 경험이 있을 것이다. 하지만 이런 방식으로 소스 파일을 만들 경우 추후 컴파일 단계에서 에러가 발생할 수 있다. 
이번 심화 탐구는 교재와 같은 방식으로 파일을 구성하였을 경우, 실제로 에러가 발생하는지, 발생한다면 혹은 발생하지 않는다면 그 경과는 어떠한지를 살펴보며 
하나의 소스 파일에 하나의 톱레벨 클래스만 담는 것이 왜 좋은지 고민해보는 것을 탐구 주제로 선정하였다. 

교재의 예제 코드를 다음과 같은 3가지 상황에 대해 탐구해보기로 했다.
1. IntelliJ
2. Spring Tool Suite(STS)
3. Terminal

먼저 첫번째로 IntelliJ에서 예제와 같이 Utensil.java, Dessert.java, Main.java 파일을 만들고 Utensil.java, Dessert.java에 각각 Utensil, Dessert 클래스를 만들었을 경우, 
`java: duplicate class: item25.Utensil` 다음과 같은 컴파일 에러가 나며 아예 실행이 안됐다. IntelliJ의 경우 해당 아이템에서 지적한 문제를 프로그램이 사전에 차단하고 있는 것으로 보였다. 

두번째로 STS의 경우 흥미로운 결과가 나왔는데, 동일하게 소스 파일을 작성했는데 에러 메시지와 `potpie`, `pancake` 모두 볼 수 있었다. 
`potpie`, `pancake`의 경우 다음과 같은 조건에서 몇 번의 테스트를 해봤는데 어떠한 규칙을 보기는 어려웠다. 
- 외부 소스 파일을 복사해서 넣는 경우 복사하는 순서대로 올라간다
- 동일 패키지에 담았을 경우 사전순이 우선순위를 가진다
- 가장 최근에 복사한 클래스가 덮어씌우는 효과를 가진다
- 그냥 그때그때 랜덤으로 불러온다

에러 메시지의 경우 코드를 삭제하고 다시 작성하면 보통 금방 없앨 수 있었다. 하지만 Utensil.java의 내용을 비웠음에도 에러 메시지가 뜬 적이 있었는데 
컴파일러가 Dessert.java의 Utensil 클래스가 아닌 Utensil.java에서 클래스를 가져오려해서 에러가 발생한 것으로 보인다. 

이처럼 애매한 결과를 얻은 감이 있지만 한 쪽 소스 파일만 먼저 작성해서 실행하고(utensil.java or Dessert.java) 다른 소스 파일을 작성하는 경우에는 먼저 작성한 소스 파일에서 값을 꾸준히 가져오는 것을 볼 수 있었다. 

마지막으로 Terminal을 통해서 교재와 동일하게 명령을 내려 컴파일을 해보고자 하였는데, 에러가 발생하여 테스트를 진행하기 어려웠다. 
검색을 통해 자바에 대한 환경변수 세팅에 문제가 있어서 그런 것으로 보였는데 해결하기가 어려웠다. 
본인의 컴퓨터에서 `javac` 명령어에 대해 `'javac'은(는) 내부 또는 외부 명령, 실행할 수 있는 프로그램, 또는 배치 파일이 아닙니다.` 해당 문장이 출력되지 않는다면 테스트를 해봐도 좋을 것 같다. 

다음과 같은 테스트를 통해 사용하는 툴, 개발 환경에 따라 톱레벨 클래스를 하나의 소스 파일에 여러 개 둘 경우 예상치 못한 에러가 발생할 수 있음을 볼 수 있었다. 
필자의 말처럼 이러한 문제를 해결하는 간단한 방법인 **톱레벨 클래스를 하나만 두는 것을 권장**하고 여러 개의 클래스를 하나의 소스 파일에서 다루어야 할 일이 생기면 
**정적 멤버 클래스와 같은 방안을 고려해보는 것을 적극 추천**한다. 

```java

// 테스트용 코드 조각

class Utensil {
    static final String NAME = "pot";
}

class Dessert {
    static final String NAME = "pie";
}

class Utensil {
    static final String NAME = "pan";
}

class Dessert {
    static final String NAME = "cake";
}

public class Main {
    public static void main(String[] args) {
        System.out.println(Utensil.NAME+ Dessert.NAME);
    }
}

```

--------------------------------------------------

### 🧠 어려웠던 점

- 같은 이름의 클래스를 서로 다른 클래스에서 정의했을 경우 우선순위에 대해 알아보고 싶었으나 쉽지 않았다. (테스트 과정에 문제가 있을 수 있음)
  - 이에 대해 아이디어를 얻고자 chatGPT를 통해 질문을 하였는데, 나의 테스트 예상에 있었던 최근에 컴파일한 파일이 우선순위를 가진다는 답변을 받았다. 
  - 추가적인 검증이 필요하긴 하나 테스트 과정에서 중복 정의로 에러가 발생한 파일은 컴파일이 안된 파일이라고 가정하면 합리적인 답변으로 보였다. 
- 자바 환경변수에 대한 설정이 어려웠다. 
  - 이전에도 User name이 한글이어서 고생했었다. 

참고자료 : chatGPT

# 한정적 와일드카드와 불공변



## item31 - 한정적 와일드카드를 사용해 API 유연성을 높이라

### 🔍 내용 요약

아이템 28과 이어지는 내용으로 매개변수화 타입은 불공변이다. 즉, 서로 다른 타입 Type1, Type2가 있을 때 `List<Type1>`은 `List<Type2>`의 하위 타입도 상위 타입도 아니다. 
직관적이지 않겠지만 `List<String>`은 `List<Object>`의 하위 타입이 아니라는 뜻인데, 이러한 불공변의 특징이 API를 유연하지 못하게 만들 수 있다. 
교재 p181의 코드처럼 제네릭을 사용해 클래스와 메서드를 선언할 경우 컴파일은 잘 되지만 완벽하진 않다. 
해당 클래스와 메서드를 사용할 경우 하위 타입에 대해서도 작동하지 않을까 하는 논리적 오류를 범할 수 있기 때문이다. 
이러한 유연하지 못한 매개변수화 타입에 대해 `한정적 와일드카드 타입`이라는 특별한 매개변수화 타입을 사용할 수 있고, 한정적 와일드카드 타입을 통해 보다 유연한 API를 작성할 수 있다. 

<br>

--------------------------------------------------

### 🧐 심화 탐구

해당 아이템의 내용을 전개하면서 p184에 PECS(producer-extends, consumer-super)라는 개념이 등장했으며, 한정적 와일드카드를 사용할 경우 따르는 개념이자 원칙으로 보였다. 
이번 아이템에서 한정적 와일드카드가 어떤 경우에 사용하려고 존재하는 것인지에 대해 고민해보고 알아보는 것을 심화 탐구의 주제로 선정하였다. 

해당 아이템에서 예제로 소개한 `pushAll`과 `popAll` 메서드를 보며 List나 PriorityQueue에서 사용하던 `addAll`이라는 메서드가 생각하서 어떻게 선언되었나 확인해보았다. 

```java

// List에서 와일드카드를 사용한 메서드
boolean addAll(Collection<? extends E> c);
```

대표적으로 자주 사용하던 `addAll`에서 역시 한정적 와일드카드를 통해 매개변수를 받고 있었다. 이외에도 매개변수를 컬렉션으로 받는 메서드들은 `<?>`와 같은 와일드카드를 제네릭으로 사용하고 있었는데, 예제를 포함해 고려해봤을 때 한정적 와일드카드는 일단 해당 클래스의 제네릭과 다른 제네릭 타입을 받고자 할 때 사용한다는 점을 느꼈고, 불공변으로 인한 불편함을 해소시켜 배열처럼 공변적으로 사용하려는 의도가 있다는 느낌이 들었다. List의 경우도 매개변수화 타입 자체가 상하위 타입 관계에 있을 경우에는 연산에 문제가 없다고 생각해서 효과적인 해결책으로 생각됐다. 

한정적 와일드카드의 경우 본 아이템에서는 `<? extends E>`와 `<? super E>` 두 가지를 소개했는데 `<? extends E>`는 E의 하위 타입, `<? super E>`는 E의 상위 타입을 허용한다는 의미이다. (자신 타입 포함) 여기서 PECS의 PE가 생산자 매개변수에서 Extends를 사용하고, CS가 소비자 매개변수에서 Super를 사용하라는 뜻이다. 

--------------------------------------------------

참고자료

https://www.baeldung.com/java-generics-pecs <br>
https://stackoverflow.com/questions/2723397/what-is-pecs-producer-extends-consumer-super <br>

--------------------------------------------------

### 🧠 어려웠던 점

- 필자의 핵심 정리 내용처럼 널리 쓰일 라이브러리를 작성하지 않는 개발자라면(사용자 입장의 개발자에게), 해당 개념이 크게 중요할지에 대한 판단이 아직은 어려웠다. 
- 생산자와 소비자의 구분이 약간 헷갈리는 느낌이 있다. 
